<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.greatway.dao.InsframeworkMapper">

	<resultMap id="insMap" type="com.greatway.model.Insframework">
		<id property="id" column="fid"></id> 
            <result property="name" column="fname"></result>  
            <result property="logogram" column="flogogram"></result>  
            <result property="code" column="fcode"></result>
        	<result property="parent" column="fparent"></result>
        	<result property="type" column="ftype"></result>
	</resultMap>
	
	<select id="getInsframeworkAll" resultMap="insMap">
		SELECT fid,fname,flogogram,fcode,fparent,ftype FROM tb_insframework where 1=1
		<if test="str!=null and str!=''">
			and ${str}
		</if>
	</select>
	
	<select id="getInsframework" resultMap="insMap">
		SELECT fid,fname,flogogram,fcode,fparent,ftype FROM tb_insframework where  ftype>22
	</select>
	
	<select id="getParent" resultMap="insMap">
		SELECT ins.fid, ins.fname
		FROM tb_insframework i
		inner JOIN tb_insframework ins ON i.fparent = ins.fid
		WHERE i.fid =#{id}
	</select>
	
	<!-- 查看公司级 -->
	<select id="getConmpany" resultMap="insMap">
		SELECT fid,fname FROM tb_insframework WHERE ftype=21
	</select>
	
	<!-- 查看事业部级 -->
	<select id="getCause" resultMap="insMap">
		SELECT fid,fname FROM tb_insframework WHERE fparent = #{id}
	</select>
	
	<!-- 获取用户所属层级 -->
	<select id="getUserInsfType" resultType="java.lang.Integer">
		SELECT ftype from tb_users u
		inner join tb_insframework i	on u.users_insframework=i.fid	where id=#{uid}
	</select>
	
	<!-- 获取用户所属事业部所拥有的项目部 -->
	<select id="getUserInsfId" resultType="java.math.BigInteger">
		SELECT fid from tb_users u
		inner join tb_insframework i	on u.users_insframework=i.fid	where id=#{uid}
	</select>
	
	<select id="getInsframeworkByName" resultType="java.math.BigInteger">
		select fid from tb_insframework where fname = #{name}
	</select>
	
	<select id="getInsframeworkById" resultType="java.lang.String">
		select fname from tb_insframework where fid = #{id}
	</select>
	
	<select id="getInsfAllById" resultMap="insMap">
		select * from tb_insframework where fid = #{id}
	</select>
	
	<select id="getInsframeworkNameCount" resultType="java.lang.Integer">
		select count(*) from tb_insframework where fname=#{name}
	</select>
	
	<select id="getInsByType" resultMap="insMap">
		select fid,fname from tb_insframework where ftype=#{type}
	</select>
	
	<insert id="addInsframework" parameterType="com.greatway.model.Insframework" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO tb_insframework(fname, flogogram, fcode, fparent, ftype) VALUES (#{name},#{logogram},#{code},#{parent},#{type})
 	</insert>
	
	<update id="editInsframework" parameterType="com.greatway.model.Insframework">
		UPDATE tb_insframework SET fname=#{name},flogogram=#{logogram},fcode=#{code},fparent=#{parent},ftype=#{type} WHERE fid=#{id}
	</update>
	
	<delete id="deleteInsframework" parameterType="java.math.BigInteger">
		DELETE FROM tb_insframework WHERE fid=#{id}
	</delete>
	
</mapper>
