<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.dao.ChartMapper">
		
	<resultMap id="dtoMap" type="com.spring.dto.ModelDto">
		<id property="fid" column="fid"></id> 
        <result property="overproof" column="overproof"></result>
        <result property="weldTime" column="weldTime"></result>
        <result property="fname" column="fname"></result>
        <result property="f_welder_id" column="f_welder_id"></result>
        <result property="fmachine_id" column="fmachine_id"></result>
        <result property="fjunction_id" column="fjunction_id"></result>
        <result property="felectricity" column="felectricity"></result>
        <result property="fvoltage" column="fvoltage"></result>
        <result property="iname" column="iname"></result>
        <result property="wname" column="wname"></result>
        <result property="livecount" column="livecount"></result>
        <result property="fmax_electricity" column="fmax_electricity"></result>
        <result property="fmin_electricity" column="fmin_electricity"></result>
        <result property="overtime" column="overtime"></result>
        <result property="time" column="time"></result>
        <result property="type" column="type"></result>
        <result property="dyne" column="dyne"></result>
        <result property="num" column="num"></result>
       	<result property="hous" column="hous"></result>
       	<result property="externalDiameter" column="fexternal_diameter"></result>
       	<result property="wallThickness" column="fwall_thickness"></result>
       	<result property="material" column="fmaterial"></result>
       	<result property="nextexternaldiameter" column="fnextExternal_diameter"></result>
       	<result property="nextwallThickness" column="fnextwall_thickness"></result>
       	<result property="nextmaterial" column="fnext_material "></result>
       	<result property="itemid" column="itemid"></result>
       	<result property="jidgather" column="jidgather"></result>
       	<result property="starttime" column="starttime"></result>
       	<result property="endtime" column="endtime"></result>
    </resultMap>
    
    <!-- 工效 -->
    <select id="getEfficiency" resultMap="dtoMap">
    	select * from (
		select * from (
		SELECT ins.fname,i.fname iname,w.fname wname,l.fwelder_id fwelder_id, COUNT(l.fid)/60/60 weldtime,group_concat(DISTINCT(j.fid)) jidgather
		FROM tb_live_data l left join tb_welder w on l.fwelder_id = w.fwelder_no
		inner join tb_welded_junction j on l.fjunction_id = j.fwelded_junction_no
		inner join tb_insframework i on i.fid = l.fitemid
		inner join tb_insframework ins on ins.fid = i.fparent
		where fweldtime like #{time} and j.fend_time is not null
		group by i.fid,w.fname
		)A 
		group by wname
		)temp
    </select>
    
    <!-- 	根据焊口获取总达因值 -->
	<select id="getDyneByJunctionno"  resultType="java.math.BigInteger">
		select SUM(fdyne) FROM tb_welded_junction where 1=1 
		<if test="str!=null and str!=''">
			${str}
		</if>
	</select>
    
    <!-- 焊口焊接工时 -->
    <select id="getHour" resultMap="dtoMap">
		select * from (
		(SELECT count( l.fid ) AS hous,ins.fname iname,  i.fname fname,group_concat(distinct(j.fid)) jidgather
		FROM tb_live_data l
		INNER JOIN tb_welded_junction j ON l.fjunction_id = j.fwelded_junction_no
		INNER JOIN tb_insframework i ON i.fid = l.fitemid
        INNER JOIN tb_insframework ins ON ins.fid = i.fparent
		WHERE fstatus &lt; 3 and j.fend_time is not null
		AND i.ftype =23 and fweldtime like #{time}
		<if test="str!=null and str!=''">
			and ${str}
		</if>
		GROUP BY i.fname
		) 
		UNION (
		SELECT 0 AS hous,ins.fname iname, i.fname,0 as jidgather
		FROM tb_insframework i
		INNER JOIN tb_insframework ins ON ins.fid = i.fparent
		WHERE  i.fid NOT
		IN (
		SELECT i.fid
		FROM tb_live_data l
		INNER JOIN tb_welded_junction j ON l.fjunction_id = j.fwelded_junction_no
		INNER JOIN tb_insframework i ON i.fid = l.fitemid
		WHERE fstatus  &lt;  3 and j.fend_time is not null
		AND i.ftype =23 and fweldtime like #{time}
		<if test="str!=null and str!=''">
			and ${str}
		</if>
		GROUP BY i.fname
		)
		AND i.ftype =23
		GROUP BY i.fname
		))temp
    </select>
    
	<!-- 获取焊口分类 -->
	<select id="getHourClassify" resultMap="dtoMap">
    	select fmaterial, fexternal_diameter, fwall_thickness, fnextExternal_diameter,fnext_material nextmaterial , fnextwall_thickness from tb_welded_junction j
		INNER JOIN tb_insframework i ON i.fid = j.fitemid
        INNER JOIN tb_insframework ins ON ins.fid = i.fparent
        where 1=1
		<if test="str!=null and str!=''">
			and ${str}
		</if>
		group by fmaterial, fexternal_diameter, fwall_thickness, fnextExternal_diameter,fnext_material,fnextwall_thickness
    </select>
    
<!--     <select id="getOverproof" resultMap="dtoMap"> -->
<!--     </select> -->
    
    
<!--     <select id="getAllInsf" resultMap="dtoMap"> -->
    
<!--     </select> -->
    
<!--     <select id="getAllTimes"> -->
<!--     </select> -->
    
</mapper>